<html>
<head>
	<title>EventBot!</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/eventbot.css">
    <script src="scripts/load-image.all.min.js"></script>
    <script src="scripts/jquery-3.1.1.min.js"></script> 
    <script src="scripts/jquery.form.min.js"></script>
    <script>
       
        $(document).ready(function () {
            var options = {
                beforeSubmit: showRequest,  // pre-submit callback
                success: showResponse  // post-submit callback
            };

            // bind to the form's submit event
            $('#frmUploader').submit(function () {
                $(this).ajaxSubmit(options);
                // always return false to prevent standard browser submit and page navigation
                return false;
            });
        });

        // pre-submit callback
        function showRequest(formData, jqForm, options) {
            alert('Uploading is starting.');
            return true;
        };

        // post-submit callback
        function showResponse(responseText, statusText, xhr, $form) {
            alert('status: ' + statusText + '\n\nresponseText: \n' + responseText );
            location.reload();
        };
    </script>
</head>
<body>
<h1>Caro and Chris' Wedding Photos</h1>
<form class="form-inline" id="frmUploader" enctype="multipart/form-data" action="api/upload/" method="post">
  	<div class="container-fluid">
	 	<div class="row-fluid">
	 		<div class="col-lg-12">
	 			<div class="content">
	 				
	 				<h3>Upload 10 photos at a time. Click "Browse", select your photos, and click "Upload"!</h3>
	 				
    <form id="frmUploader" enctype="multipart/form-data" action="api/upload/" method="post">
        <label class="sr-only" for="inlineFormInput" id="yourname">Your Name</label>
	<input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" id="inlineFormInput" placeholder="Your Name">
	<label class="btn btn-primary">Browse&hellip;
            <input type="file" style="display: none;" name="imgUploader" multiple />
	</label>
	<button type="submit" class="btn btn-primary" name="submit" id="btnSubmit" value="Upload">Upload</button>
    </form>

 				</div>
	 		</div>
	 	</div>
	 </div>
</form>	

<!--Loads image for each item in the pictures list array. Generates html -->
<div class="containergallery">
<div class="row">
	<%pictures.forEach(function(picture){ %>
    <div class="col-xs-12 col-lg-4"><img src="<%= picture %>" class="img-thumbnail"></div>
<%}); %>
  	
</div>
</div>
<script type="text/javascript">
    var yourname = getElementById("yourname").value;
     //gets a list of img-thumbnail elements
    var list_of_elements = document.getElementsByClassName("img-thumbnail");
    console.log(list_of_elements);

    // loop over list and set event handler to change orientation
    var imgs = [];
    for (var i = 0; i < list_of_elements.length; i++) {
        list_of_elements[i].onload = function(e) {
            //console.log(e);
            //console.log(e.path[0].src);
            var newimg = loadImage(
                e.path[0].src,
                function (img) {
                    console.log(img);
                    $(e.currentTarget).addClass("img-thumbnail");
                    $(e.currentTarget).replaceWith(img);
                    document.body.appendChild(img);
                },
                {
                    orientation: true,
                    canvas: false,
                    noRevoke: true,
                }
            );
            $(newimg).addClass("img-thumbnail");
            $(e.currentTarget).replaceWith(newimg);
            console.log(e.currentTarget);
        };
    };

</script>


</body>
</html>


